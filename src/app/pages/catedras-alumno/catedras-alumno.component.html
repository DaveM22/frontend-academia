<p-card styleClass="h-full">
    <ng-template pTemplate="header">
        <h2 class="text-3xl text-center font-bold text-white pb-2">Estado de cátedras inscriptas</h2>
    </ng-template>
    <ng-template pTemplate="content" class="pt-0">
        <p-table #dt2 [value]="inscripcionesFiltradas" responsiveLayout="stack" [breakpoint]="'960px'" [paginator]="true"
            [scrollable]="true" [rows]="rowsPerPage" 
            scrollHeight="flex" [loading]="(loading$ | async)!" size="small"
            styleClass="p-datatable-gridlines p-datatable-striped h-full pt-0 text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl"
            [globalFilterFields]="['curso.materia.descripcion', 'curso.comision.descripcion', 'condicion']">
            <ng-template pTemplate="caption">

                <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-4 w-full">
                    <!-- Filtro Condición -->
                    <div class="order-2 lg:order-1 w-full lg:w-1/3">
                        <label class="block text-xs sm:text-sm md:text-base font-medium mb-2">Filtrar por condición:</label>
                        <p-dropdown 
                            [options]="condiciones" 
                            [(ngModel)]="selectedCondicion"
                            optionLabel="label" 
                            optionValue="value"
                            placeholder="Todas las condiciones"
                            [showClear]="true"
                            styleClass="w-full text-xs sm:text-sm md:text-base"
                            (onChange)="onCondicionChange($event)">
                        </p-dropdown>
                    </div>

                    <!-- Botón Ver Resumen -->
                    <div class="order-1 lg:order-2 w-full lg:w-auto lg:flex-1 lg:flex lg:justify-center">
                        <p-button 
                            label="Ver resumen" 
                            severity="info"
                            class="text-xs sm:text-sm md:text-base lg:text-base xl:text-base w-full lg:w-auto"
                            styleClass="w-full lg:w-auto px-2 py-1 sm:px-3 sm:py-2 md:px-4 md:py-2 lg:px-4 lg:py-2"
                            (onClick)="showResumenModal()">
                        </p-button>
                    </div>

                    <!-- Búsqueda -->
                    <div class="order-3 lg:order-3 w-full lg:w-1/3">
                        <label class="block text-xs sm:text-sm md:text-base font-medium mb-2">Búsqueda:</label>
                        <p-iconField iconPosition="left" class="w-full">
                            <p-inputIcon>
                                <i class="pi pi-search"></i>
                            </p-inputIcon>
                            <input pInputText pSize="large" type="text" 
                                class="text-md sm:text-base md:text-base lg:text-base xl:text-base w-full h-[50px]"
                                (input)="dt2.filterGlobal($any($event.target).value, 'contains')"
                                placeholder="Buscar cátedra" />
                        </p-iconField>
                    </div>
                </div>

                <div class="lg:hidden mb-2">
                    <label class="block text-xs sm:text-sm md:text-base font-medium mb-2">Seleccionar columna:</label>
                    <app-mobile-sort-select [sortOptions]="sortOptions" [table]="dt2"></app-mobile-sort-select>
                </div>

            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>Cátedra</th>
                    <th>Comisión</th>
                    <th>Condición</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-inscripcion>
                <tr>
                    <td style="width:40%"><span
                            class="p-column-title">Catedra</span>{{inscripcion.curso.materia.descripcion}}</td>
                    <td style="width:40%"><span
                            class="p-column-title">Comisión</span>{{inscripcion.curso.comision.descripcion}}</td>
                    <td style="width:20%"><span class="p-column-title">Comisión</span>{{inscripcion.condicion}}</td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                @if (inscripciones.length === 0) {
                <tr>
                    <td class="text-center text-md sm:text-base md:text-base lg:text-base xl:text-base" colspan="3">
                        No se han registrado cátedras inscriptas del alumno
                    </td>
                </tr>
                }
                @else {
                <tr>
                    <td class="text-center text-xs sm:text-sm md:text-base lg:text-base xl:text-base" colspan="3">
                        No se encontraron cátedras con el filtro aplicado
                    </td>
                </tr>
                }
            </ng-template>
        </p-table>
    </ng-template>
</p-card>


<p-dialog 
    header="Resumen de Condiciones" 
    [(visible)]="displayResumenModal" 
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-11/12 md:w-1/2 lg:w-1/3"
    [baseZIndex]="10000">
    
    <div class="space-y-4">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">
            Estadísticas de materias por condición:
        </h3>
        
        <div class="grid grid-cols-1 gap-4">
            <!-- Aprobadas -->
            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-green-800 dark:text-green-200">Materias Aprobadas</span>
                    <span class="text-2xl font-bold text-green-600 dark:text-green-400">{{ resumenCondiciones.aprobado }}</span>
                </div>
                <i class="pi pi-check-circle text-green-500 text-lg mt-2"></i>
            </div>
            
            <!-- Inscriptas -->
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-blue-800 dark:text-blue-200">Materias Inscriptas</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ resumenCondiciones.inscripto }}</span>
                </div>
                <i class="pi pi-bookmark text-blue-500 text-lg mt-2"></i>
            </div>
            
            <!-- Regulares -->
            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Materias Regulares</span>
                    <span class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">{{ resumenCondiciones.regular }}</span>
                </div>
                <i class="pi pi-clock text-yellow-500 text-lg mt-2"></i>
            </div>
            
            <!-- Total -->
            <div class="p-4 bg-gray-50 dark:bg-gray-900/20 rounded-lg border border-gray-200 dark:border-gray-800 mt-2">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Total de Materias</span>
                    <span class="text-2xl font-bold text-gray-600 dark:text-gray-400">{{ resumenCondiciones.total }}</span>
                </div>
                <i class="pi pi-list text-gray-500 text-lg mt-2"></i>
            </div>
        </div>
    </div>
    
    <ng-template pTemplate="footer">
        <p-button 
            label="Cerrar" 
            icon="pi pi-times"
            class="text-xs sm:text-sm md:text-base"
            (onClick)="displayResumenModal = false">
        </p-button>
    </ng-template>
</p-dialog>