<div class="w-full">
  <div class="grid grid-cols-12 gap-4 mb-8">
    <div class="col-span-12">
      <h1 class="text-2xl md:text-3xl font-bold text-white">Bienvenido al panel docente</h1>
      <p class="text-sm sm:text-base md:text-lg text-white/80 mt-2">
        Aquí podrás acceder a tus cátedras asignadas, ver inscripciones y gestionar el seguimiento académico de tus
        alumnos.
      </p>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-4 mb-8">
    <div class="col-span-12 sm:col-span-6 lg:col-span-4">
      <div class="rounded-lg bg-gray-800 p-4 flex flex-col gap-2">
        <span class="text-xs sm:text-sm text-gray-400">Cátedras</span>
        @if (profesorLoading$ | async) {
          <div class="h-6 w-16 bg-gray-700 rounded animate-pulse"></div>
        } @else {
          <span class="text-lg sm:text-xl font-semibold text-indigo-400">{{ (catedrasAsignadas$ | async) ?? '--' }}</span>
        }
        <span class="text-[10px] sm:text-xs text-gray-500">Asignadas</span>
      </div>
    </div>
    <div class="col-span-12 sm:col-span-6 lg:col-span-4">
      <div class="rounded-lg bg-gray-800 p-4 flex flex-col gap-2">
        <span class="text-xs sm:text-sm text-gray-400">Cursos</span>
        @if (profesorLoading$ | async) {
          <div class="h-6 w-16 bg-gray-700 rounded animate-pulse"></div>
        } @else {
          <span class="text-lg sm:text-xl font-semibold text-indigo-400">{{ (cursosActivos$ | async) ?? '--' }}</span>
        }
        <span class="text-[10px] sm:text-xs text-gray-500">Activos</span>
      </div>
    </div>
    <div class="col-span-12 sm:col-span-6 lg:col-span-4">
      <div class="rounded-lg bg-gray-800 p-4 flex flex-col gap-2">
        <span class="text-xs sm:text-sm text-gray-400">Inscripciones</span>
        @if (profesorLoading$ | async) {
          <div class="h-6 w-24 bg-gray-700 rounded animate-pulse"></div>
        } @else {
          <span class="text-lg sm:text-xl font-semibold text-indigo-400">{{ (inscripcionesEnRevision$ | async) ?? '--' }}</span>
        }
        <span class="text-[10px] sm:text-xs text-gray-500">En revisión</span>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-4">
    <div class="col-span-12">
      @if (error$ | async) {
      <p-message severity="error" text="Error al cargar notificaciones"></p-message>
      }


      <p-card>
        <ng-template pTemplate="header">
          <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 p-6 rounded-t-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <i class="pi pi-bell text-2xl text-white"></i>
                <div>
                  <h2 class="text-xl md:text-2xl font-bold text-white">Notificaciones Recientes</h2>
                  <p class="text-sm text-indigo-100">Últimas actualizaciones académicas</p>
                </div>
              </div>
              @let count = noLeidasCount$ | async;
              @if ((count ?? 0) > 0) {
              <p-badge [value]="count ?? 0" severity="danger" styleClass="ml-2"></p-badge>
              }
            </div>
          </div>
        </ng-template>

        <div class="flex flex-col flex-1 min-h-0">
          @let notificaciones = notificaciones$ | async;
          <p-table #notificacionesTable 
            [value]="notificaciones ?? []" 
            styleClass="p-datatable-gridlines p-datatable-striped h-full pt-0 text-xs sm:text-sm md:text-base lg:text-base xl:text-base"
            responsiveLayout="stack"
            [breakpoint]="'960px'"
            [paginator]="true"
            [scrollable]="true"
            size="small"
            [rows]="10"
            [scrollHeight]="'70vh'"
            [globalFilterFields]="['titulo', 'mensaje']"
            [loading]="loading$ | async">
            
            <ng-template pTemplate="caption">
              <div class="flex flex-col gap-3">
                <div class="flex justify-between items-center">
                  <span class="text-lg font-semibold text-white">Historial de Notificaciones</span>
                  <p-iconField iconPosition="left">
                    <p-inputIcon>
                      <i class="pi pi-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text"
                      class="text-xs sm:text-sm md:text-base lg:text-base xl:text-base"
                      (input)="notificacionesTable.filterGlobal($any($event.target).value, 'contains')"
                      placeholder="Buscar notificación" />
                  </p-iconField>
                </div>
              </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th style="width: 8%">Estado</th>
                <th pSortableColumn="titulo" pRipple style="width: 25%">Título <p-sortIcon field="titulo"></p-sortIcon></th>
                <th pSortableColumn="mensaje" pRipple style="width: 42%">Mensaje <p-sortIcon field="mensaje"></p-sortIcon></th>
                <th pSortableColumn="fechaCreacion" pRipple style="width: 25%">Fecha <p-sortIcon field="fechaCreacion"></p-sortIcon></th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-notificacion>
              <tr [class.opacity-60]="notificacion.leida">
                <td><span class="p-column-title">Estado</span>
                  @if (!notificacion.leida) {
                    <span class="inline-block w-3 h-3 bg-blue-500 rounded-full"></span>
                  } @else {
                    <span class="text-gray-500 text-xs">✓ Leída</span>
                  }
                </td>
                <td><span class="p-column-title">Título</span>
                  <span class="font-semibold text-white">{{ notificacion.titulo }}</span>
                </td>
                <td><span class="p-column-title">Mensaje</span>
                  <span class="text-gray-300">{{ notificacion.mensaje }}</span>
                </td>
                <td><span class="p-column-title">Fecha</span>
                  <span class="text-gray-400 text-sm">{{ notificacion.fechaCreacion | date: 'dd/MM/yyyy' }}</span>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="4">
                  <div class="flex flex-col items-center justify-center py-6">
                    <p-progressSpinner styleClass="mb-3" strokeWidth="4"></p-progressSpinner>
                    <span class="text-xs sm:text-sm md:text-base lg:text-base xl:text-base font-semibold">Cargando notificaciones...</span>
                  </div>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="4" class="text-center">No hay notificaciones registradas</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-card>
    </div>
  </div>
</div>