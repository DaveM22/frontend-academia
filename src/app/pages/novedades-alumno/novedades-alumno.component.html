<div class="w-full">

  @if (error$ | async) {
    <p-message severity="error" [text]="(errorMessage$ | async) || 'Error al cargar novedades'"></p-message>
  }


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12 md:col-span-6">
      <h1 class="text-2xl md:text-3xl font-bold">Novedades</h1>
    </div>
    <div class="col-span-12 md:col-span-6 flex items-end justify-end">
      <p-button 
        icon="pi pi-refresh"
        (onClick)="onRefresh()"
        severity="secondary"
        [rounded]="true"
        [text]="true"
      ></p-button>
    </div>
  </div>


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12">
      <p-iconField iconPosition="left">
        <p-inputIcon>
          <i class="pi pi-search"></i>
        </p-inputIcon>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="filtroSearch" 
          placeholder="Buscar novedades..."
          class="w-full"
        />
      </p-iconField>
    </div>
  </div>

  @if (loading$ | async) {
    <div class="flex justify-center items-center py-12">
      <p-progressSpinner [style]="{ width: '50px', height: '50px' }" strokeWidth="4"></p-progressSpinner>
    </div>
  } @else {
    @let notificaciones = notificacionesFiltradas | async;
    @if (notificaciones && notificaciones.length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        @for (notificacion of notificaciones; track notificacion._id) {
          <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 hover:border-indigo-500 transition-colors"
               [class.opacity-60]="notificacion.leida"
               (click)="marcarComoLeida(notificacion)"
               style="cursor: pointer;">
            <div class="flex items-start justify-between mb-3">
              <p-tag [value]="getTipoLabel(notificacion.tipo)" 
                     [severity]="getTipoColor(notificacion.tipo)"></p-tag>
              <p-tag [value]="getEstadoLabel(notificacion.leida)" 
                     [severity]="getEstadoColor(notificacion.leida)"
                     styleClass="ml-2"></p-tag>
            </div>

            <div class="mb-4">
              <h3 class="text-lg font-semibold mb-2 text-white">{{ notificacion.titulo }}</h3>
              <p class="text-sm text-gray-300 mb-4">{{ notificacion.mensaje }}</p>
              <div class="text-xs text-gray-400">
                <p>Fecha: {{ notificacion.fechaCreacion | date: 'medium' }}</p>
                @if (notificacion.fechaLectura) {
                  <p>Le√≠da: {{ notificacion.fechaLectura | date: 'medium' }}</p>
                }
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="text-center py-12">
        <i class="pi pi-inbox text-5xl text-gray-400 mb-4"></i>
        <p class="text-gray-400 text-lg">No tienes novedades</p>
      </div>
    }
  }
</div>
