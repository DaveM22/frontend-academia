<div class="w-full">

  @if (error$ | async) {
    <p-message severity="error" [text]="(errorMessage$ | async) || 'Error al cargar novedades'"></p-message>
  }


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12 md:col-span-6">
      <h1 class="text-2xl md:text-3xl font-bold">Historial de Novedades</h1>
    </div>
    <div class="col-span-12 md:col-span-6 flex items-end justify-end">
      <p-button 
        icon="pi pi-refresh"
        (onClick)="onRefresh()"
        severity="secondary"
        [rounded]="true"
        [text]="true"
      ></p-button>
    </div>
  </div>


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12 md:hidden mb-2">
      <app-mobile-sort-select [sortOptions]="sortOptions" [table]="table"></app-mobile-sort-select>
    </div>
    <div class="col-span-12">
      <p-iconField iconPosition="left">
        <p-inputIcon>
          <i class="pi pi-search"></i>
        </p-inputIcon>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="filtroSearch" 
          placeholder="Buscar novedades..."
          class="w-full"
        />
      </p-iconField>
    </div>
  </div>

  @if (loading$ | async) {
    <div class="flex justify-center items-center py-12">
      <p-progressSpinner [style]="{ width: '50px', height: '50px' }" strokeWidth="4"></p-progressSpinner>
    </div>
  } @else {
    @if (notificaciones && notificaciones.length > 0) {
      <div class="overflow-auto">
        <p-table #dt2 [value]="notificaciones" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-striped">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="leida" pRipple style="width: 10%">Estado <p-sortIcon field="leida"></p-sortIcon></th>
              <th pSortableColumn="titulo" pRipple style="width: 25%">Título <p-sortIcon field="titulo"></p-sortIcon></th>
              <th pSortableColumn="mensaje" pRipple style="width: 35%">Mensaje <p-sortIcon field="mensaje"></p-sortIcon></th>
              <th pSortableColumn="fechaCreacion" pRipple style="width: 20%">Fecha <p-sortIcon field="fechaCreacion"></p-sortIcon></th>
              <th style="width: 10%">Acción</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-notificacion>
            <tr [class.opacity-60]="notificacion.leida">
              <td>
                @if (!notificacion.leida) {
                  <span class="inline-block w-3 h-3 bg-blue-500 rounded-full"></span>
                } @else {
                  <span class="text-gray-500 text-sm">✓ Leída</span>
                }
              </td>
              <td class="font-semibold text-white">{{ notificacion.titulo }}</td>
              <td class="text-gray-300 line-clamp-2">{{ notificacion.mensaje }}</td>
              <td class="text-gray-400 text-sm">{{ notificacion.fechaCreacion | date: 'dd/MM/yyyy' }}</td>
              <td>
                @if (!notificacion.leida) {
                  <p-button 
                    label="Marcar"
                    (onClick)="marcarComoLeida(notificacion)"
                    [rounded]="true"
                    [text]="true"
                    severity="info"
                    size="small"
                    icon="pi pi-check"
                  ></p-button>
                }
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    } @else {
      <div class="text-center py-12">
        <i class="pi pi-inbox text-5xl text-gray-400 mb-4"></i>
        <p class="text-gray-400 text-lg">No tienes novedades</p>
      </div>
    }
  }
</div>
