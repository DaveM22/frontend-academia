<div class="w-full">

  @if (error$ | async) {
    <p-message severity="error" [text]="(errorMessage$ | async) || 'Error al cargar notificaciones'"></p-message>
  }


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12 md:col-span-6">
      <h1 class="text-2xl md:text-3xl font-bold">Notificaciones</h1>
    </div>
    <div class="col-span-12 md:col-span-6 flex items-end justify-end">
      <p-button 
        icon="pi pi-refresh"
        (onClick)="onRefresh()"
        severity="secondary"
        [rounded]="true"
        [text]="true"
      ></p-button>
    </div>
  </div>


  <div class="grid grid-cols-12 gap-4 mb-6">
    <div class="col-span-12">
      <p-iconField iconPosition="left">
        <p-inputIcon>
          <i class="pi pi-search"></i>
        </p-inputIcon>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="filtroSearch"
          placeholder="Buscar por título o mensaje"
          class="w-full"
        />
      </p-iconField>
    </div>
  </div>

  @if ((loading$ | async)) {
    <div class="flex flex-col items-center justify-center py-12">
      <p-progressSpinner strokeWidth="4" styleClass="mb-4"></p-progressSpinner>
      <span class="text-sm md:text-base font-semibold">Cargando notificaciones...</span>
    </div>
  } @else {

    @let notificaciones = notificaciones$ | async;
    @if (notificaciones && notificaciones.length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        @for (notificacion of notificaciones; track notificacion._id) {
          <div 
            class="notificacion-item p-4 rounded-lg border-2 transition-all"
            [ngClass]="{'not-read bg-blue-50 border-blue-200': !notificacion.leida, 'bg-white border-gray-200': notificacion.leida}"
          >

            <div class="flex justify-between items-start mb-3">
              <div class="flex-1">
                <h3 class="text-base md:text-lg font-semibold text-gray-800">{{ notificacion.titulo }}</h3>
              </div>
              @if (!notificacion.leida) {
                <span class="unread-badge w-2 h-2 rounded-full bg-blue-500 ml-2"></span>
              }
            </div>


            <div class="mb-3">
              <p-tag 
                [value]="getTipoLabel(notificacion.tipo)"
                [severity]="getTipoColor(notificacion.tipo)"
              ></p-tag>
            </div>

 
            <p class="text-sm md:text-base text-gray-700 mb-4">{{ notificacion.mensaje }}</p>

            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
              <div class="text-xs md:text-sm text-gray-600">
                {{ notificacion.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}
              </div>
              <div class="flex items-center gap-2">
                <p-tag 
                  [value]="getEstadoLabel(notificacion.leida)"
                  [severity]="getEstadoColor(notificacion.leida)"
                ></p-tag>
                @if (!notificacion.leida) {
                  <p-button 
                    label="Marcar como leída"
                    (onClick)="marcarComoLeida(notificacion)"
                    [rounded]="true"
                    [text]="true"
                    severity="info"
                    size="small"
                    icon="pi pi-check"
                  ></p-button>
                }
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="flex flex-col items-center justify-center py-12 text-gray-500">
        <i class="pi pi-inbox text-4xl mb-4"></i>
        <p class="text-lg">No hay notificaciones</p>
      </div>
    }
  }
</div>
