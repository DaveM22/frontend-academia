<div class="w-full">

  @if (error$ | async) {
  <p-message severity="error" [text]="(errorMessage$ | async) || 'Error al cargar notificaciones'"></p-message>
  }

  <p-table #dt2 [value]="nots"
    styleClass="p-datatable-gridlines p-datatable-striped h-full pt-0 text-xs sm:text-sm md:text-base lg:text-base xl:text-base"
    responsiveLayout="stack" [breakpoint]="'960px'" [paginator]="true" [scrollable]="true" size="small" [rows]="10"
    [scrollHeight]="'70vh'" [globalFilterFields]="['titulo', 'mensaje', 'fechaCreacion']">

    <ng-template pTemplate="caption">
      <div class="flex flex-col gap-3">
        <div class="flex justify-between items-center flex-wrap">
          <span class="text-lg font-semibold text-white">Historial de Notificaciones</span>
          <div class="flex items-center gap-2">
            <p-button icon="pi pi-refresh" (onClick)="onRefresh()" severity="secondary" [rounded]="true" [text]="true"
              pTooltip="Actualizar notificaciones" tooltipPosition="top"></p-button>
            <p-iconField iconPosition="left">
              <p-inputIcon>
                <i class="pi pi-search"></i>
              </p-inputIcon>
              <input pInputText type="text" class="text-xs sm:text-sm md:text-base lg:text-base xl:text-base"
                (input)="dt2.filterGlobal($any($event.target).value, 'contains')" placeholder="Buscar notificación" />
            </p-iconField>
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template #header>
      <tr>
        <th style="width: 8%">Estado</th>

        <th style="width: 20%" pSortableColumn="titulo">Título <p-sortIcon field="titulo"></p-sortIcon></th>
        <th style="width: 50%" pSortableColumn="mensaje">Mensaje <p-sortIcon field="mensaje"></p-sortIcon></th>
        <th style="width: 22%" pSortableColumn="fechaCreacion">Fecha <p-sortIcon field="fechaCreacion"></p-sortIcon>
        </th>
      </tr>
    </ng-template>

    <ng-template #body let-notificacion>
      <tr [class.opacity-60]="notificacion.leida">
        <td><span class="p-column-title">Estado</span>
          @if (!notificacion.leida) {
          <span class="inline-block w-3 h-3 bg-blue-500 rounded-full"></span>
          } @else {
          <span class="text-gray-500 text-xs">✓ Leída</span>
          }
        </td>
        <td><span class="p-column-title">Título</span>
          <span class="font-semibold text-white">{{ notificacion.titulo }}</span>
        </td>
        <td><span class="p-column-title">Mensaje</span>
          <span class="text-gray-300">{{ notificacion.mensaje }}</span>
        </td>
        <td><span class="p-column-title">Fecha</span>
          <span class="text-gray-400 text-sm">{{ notificacion.fechaCreacion | date: 'dd/MM/yyyy' }}</span>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center">No hay notificaciones registradas</td>
      </tr>
    </ng-template>
  </p-table>

</div>