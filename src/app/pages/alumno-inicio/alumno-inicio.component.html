<div class="w-full">

  <div class="grid grid-cols-12 gap-4 mb-8">
    <div class="col-span-12">
      <h1 class="text-2xl md:text-3xl font-bold text-white">Bienvenido a tu panel</h1>
      <p class="text-sm sm:text-base md:text-lg text-white/80 mt-2">
        Aquí podrás acceder rápidamente a tus cátedras, inscripciones y novedades académicas.
      </p>
    </div>
  </div>


  <div class="grid grid-cols-12 gap-4">
    <div class="col-span-12">
      @if (error$ | async) {
        <p-message severity="error" text="Error al cargar novedades"></p-message>
      }

 
      <p-card>
        <ng-template pTemplate="header">
          <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 p-6 rounded-t-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <i class="pi pi-bell text-2xl text-white"></i>
                <div>
                  <h2 class="text-xl md:text-2xl font-bold text-white">Novedades Recientes</h2>
                  <p class="text-sm text-indigo-100">Últimas actualizaciones académicas</p>
                </div>
              </div>
              @let count = noLeidasCount$ | async;
              @if ((count ?? 0) > 0) {
                <p-badge [value]="count ?? 0" severity="danger" styleClass="ml-2"></p-badge>
              }
            </div>
          </div>
        </ng-template>

        <div class="p-6 flex flex-col flex-1 min-h-0">
          @if (loading$ | async) {
            <div class="flex justify-center items-center flex-1">
              <p-progressSpinner [style]="{ width: '50px', height: '50px' }" strokeWidth="4"></p-progressSpinner>
            </div>
          } @else {
            @let notificaciones = notificaciones$ | async;
            @if (notificaciones && notificaciones.length > 0) {
              <div class="flex-1 min-h-0 overflow-auto">
                <p-table [value]="notificaciones.slice(0, 5)" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-striped text-md sm:text-base md:text-base lg:text-base xl:text-base">
                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn style="width: 10%">Estado <p-sortIcon field="leida"></p-sortIcon></th>
                      <th pSortableColumn style="width: 30%">Título <p-sortIcon field="titulo"></p-sortIcon></th>
                      <th pSortableColumn style="width: 40%">Mensaje <p-sortIcon field="mensaje"></p-sortIcon></th>
                      <th pSortableColumn style="width: 20%">Fecha <p-sortIcon field="fechaCreacion"></p-sortIcon></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-notificacion>
                    <tr [class.opacity-60]="notificacion.leida">
                      <td>
                        @if (!notificacion.leida) {
                          <span class="inline-block w-3 h-3 bg-blue-500 rounded-full"></span>
                        } @else {
                          <span class="text-gray-500 text-sm">✓ Leída</span>
                        }
                      </td>
                      <td class="font-semibold text-white">{{ notificacion.titulo }}</td>
                      <td class="text-gray-300 line-clamp-1">{{ notificacion.mensaje }}</td>
                      <td class="text-gray-400 text-sm">{{ notificacion.fechaCreacion | date: 'short' }}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            } @else {
              <div class="flex justify-center flex-1">
                <div class="text-center py-8 flex flex-col justify-center">
                  <i class="pi pi-inbox text-4xl text-gray-400 mb-3 block"></i>
                  <p class="text-gray-400">No tienes novedades en este momento</p>
                </div>
              </div>
            }
          }

          <div class="flex justify-center pt-4 border-t border-gray-700 flex-shrink-0">
            <p-button 
              label="Ver todas las novedades"
              icon="pi pi-arrow-right"
              (onClick)="verTodasLasNovedades()"
              severity="secondary"
              [text]="true"
            ></p-button>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>